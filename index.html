<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pong FX</title>
  <style>
    body { margin: 0; background: black; color: white; font-family: sans-serif; text-align: center; }
    #ui {
      padding: 10px;
      background: #222;
      border-bottom: 2px solid white;
    }
    canvas {
      display: block;
      margin: 20px auto;
      background: #111;
      border: 2px solid white;
    }
    .touch-controls {
      display: none;
      margin-top: 10px;
    }
    .btn {
      padding: 15px 30px;
      margin: 5px;
      font-size: 18px;
      background: #444;
      color: white;
      border: 1px solid white;
      border-radius: 8px;
      user-select: none;
    }
    @media (max-width: 600px) {
      .touch-controls {
        display: flex;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

<div id="ui">
  <h1>Pong FX</h1>
  <p>Use <strong>W</strong> / <strong>S</strong> or touch buttons to move.</p>
</div>

<canvas id="gameCanvas" width="480" height="320"></canvas>

<div class="touch-controls">
  <div class="btn" id="btnUp">Up</div>
  <div class="btn" id="btnDown">Down</div>
</div>

<script>
// === SETUP ===
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// === TOUCH BUTTONS ===
let touchUp = false;
let touchDown = false;

document.getElementById("btnUp").addEventListener("touchstart", () => touchUp = true);
document.getElementById("btnUp").addEventListener("touchend", () => touchUp = false);
document.getElementById("btnDown").addEventListener("touchstart", () => touchDown = true);
document.getElementById("btnDown").addEventListener("touchend", () => touchDown = false);

// === PARTICLE SYSTEM ===
let particles = [];
function spawnParticles(x, y) {
  for (let i = 0; i < 10; i++) {
    particles.push({ x, y, dx: Math.random()*4-2, dy: Math.random()*4-2, life: 30 });
  }
}

// === GAME STATE ===
let ball = { x: 240, y: 160, dx: 3, dy: 2 };
let leftPaddle = { y: 120 };
let rightPaddle = { y: 120 }; // AI
const paddleHeight = 80;

// === DRAW FUNCTIONS ===
function drawRect(x, y, w, h, color="white") {
  ctx.fillStyle = color;
  ctx.fillRect(x, y, w, h);
}

function drawBall() {
  drawRect(ball.x - 5, ball.y - 5, 10, 10);
}

function drawParticles() {
  for (let p of particles) {
    drawRect(p.x, p.y, 2, 2, "yellow");
  }
}

// === UPDATE ===
function update() {
  // Player paddle
  if (keys["w"] || touchUp) leftPaddle.y -= 5;
  if (keys["s"] || touchDown) leftPaddle.y += 5;
  leftPaddle.y = Math.max(0, Math.min(240, leftPaddle.y));

  // AI paddle logic
  if (ball.y < rightPaddle.y + paddleHeight / 2) rightPaddle.y -= 3;
  else if (ball.y > rightPaddle.y + paddleHeight / 2) rightPaddle.y += 3;
  rightPaddle.y = Math.max(0, Math.min(240, rightPaddle.y));

  // Move ball
  ball.x += ball.dx;
  ball.y += ball.dy;

  // Bounce top/bottom
  if (ball.y <= 0 || ball.y >= 310) ball.dy *= -1;

  // Bounce paddles
  if (ball.x < 30 && ball.y > leftPaddle.y && ball.y < leftPaddle.y + paddleHeight) {
    ball.dx *= -1;
    spawnParticles(ball.x, ball.y);
  }
  if (ball.x > 450 && ball.y > rightPaddle.y && ball.y < rightPaddle.y + paddleHeight) {
    ball.dx *= -1;
    spawnParticles(ball.x, ball.y);
  }

  // Reset if out of bounds
  if (ball.x < 0 || ball.x > 480) {
    ball.x = 240;
    ball.y = 160;
    ball.dx = 3 * (Math.random() > 0.5 ? 1 : -1);
    ball.dy = 2 * (Math.random() > 0.5 ? 1 : -1);
  }

  // Update particles
  particles = particles.filter(p => p.life-- > 0);
  for (let p of particles) {
    p.x += p.dx;
    p.y += p.dy;
  }
}

// === MAIN LOOP ===
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  update();
  drawRect(10, leftPaddle.y, 10, paddleHeight);
  drawRect(460, rightPaddle.y, 10, paddleHeight);
  drawBall();
  drawParticles();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
